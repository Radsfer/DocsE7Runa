# üìÑ Arquivo `tarefas.js`

## 1. Vis√£o Geral

O m√≥dulo **`tarefas.js`** implementa a l√≥gica de carregamento, exibi√ß√£o e manipula√ß√£o de tarefas de um usu√°rio, integrando-se ao Firebase Firestore para persist√™ncia de dados e ao sistema de autentica√ß√£o do Firebase Auth. Seu foco principal √© apresentar listas de tarefas futuras, expiradas e conclu√≠das, fornecer um contador regressivo para o pr√≥ximo evento, al√©m de tratar tarefas peri√≥dicas.

---

## 2. Depend√™ncias e Importa√ß√µes

```js
import { auth } from './auth.js';
import { db }   from './firebase-config.js';
import {
  collection, getDocs, getDoc, doc,
  updateDoc, deleteDoc, Timestamp, addDoc
} from 'https://www.gstatic.com/firebasejs/11.6.0/firebase-firestore.js';
```

* **`auth`**: objeto de autentica√ß√£o do Firebase.
* **`db`**: inst√¢ncia do Firestore.
* **Firestore SDK**: fun√ß√µes para CRUD e manipula√ß√£o de `Timestamp`.

---

## 3. Estado Global

```js
let carregandoTarefas = false;
let tempoMaisRecente     = null;
let intervaloContador    = null;
let tarefasFuturas       = [];
let tarefasExpiradas     = [];
let tarefasConcluidas    = [];
```

* Flags de carregamento e refer√™ncia ao pr√≥ximo prazo.
* Tr√™s arrays para categorizar tarefas conforme o seu estado.

---

## 4. Fluxo de Carregamento e Renderiza√ß√£o

1. **`async function carregarTarefas()`**

   * (Implementa√ß√£o n√£o mostrada) deve buscar todas as tarefas do Firestore, filtrar por `finalizada` e `dataLimite`, popular os arrays e chamar fun√ß√µes de renderiza√ß√£o.
2. **`function renderizarTarefa(t)`**

   * Encapsula a cria√ß√£o de elementos DOM para cada tarefa (detalhes omitidos).

---

## 5. Manipula√ß√£o de XP e N√≠vel

```js
function atualizarXP(tarefasConcluidas) { ‚Ä¶ }
```

* Cada tarefa conclu√≠da rende **10 XP**.
* N√≠vel = ‚åä(XP\_total / 100)‚åã + 1.
* Barra de progresso e texto s√£o atualizados no elemento `.xp-info`.

---

## 6. Limpeza e Organiza√ß√£o de Cards

* **`limparCards()`**: reseta o conte√∫do dos containers `.purple-card` (expiradas) e `.blue-card` (conclu√≠das).
* **`adicionarNaCard(tarefa, cardClass)`**: adiciona um `<p>` com descri√ß√£o, data/hora formatadas e bot√£o de exclus√£o.

---

## 7. Opera√ß√µes no Firestore

* **`atualizarTarefaNoFirestore(id, descricao, dataLimite)`**
* **`excluirTarefaDoFirestore(id)`**

  * Obt√™m o `uid` do usu√°rio atual, referenciam o documento e aplicam atualiza√ß√£o ou exclus√£o.

---

## 8. Modais de Edi√ß√£o e Detalhe

```js
function abrirModalDetalhe(tarefa) { ‚Ä¶ }
```

* Exibe campos para editar descri√ß√£o, prazo e tipo de tarefa.
* Bot√µes ‚ÄúSalvar‚Äù e ‚ÄúExcluir‚Äù disparam as fun√ß√µes de CRUD e recarregam a lista.

---

## 9. Contador para Pr√≥xima Tarefa

```js
function atualizarContadorProximaTarefa() { ‚Ä¶ }
```

* Executado a cada segundo via `setInterval`.
* Move tarefas vencidas de `tarefasFuturas` ‚Üí `tarefasExpiradas`, atualiza DOM.
* Ordena `tarefasFuturas` e calcula diferen√ßa de tempo para exibir no elemento `.next-event`.

---

## 10. Atualiza√ß√£o da Data Atual

```js
function atualizarDataAtual() { ‚Ä¶ }
```

* Exibe no formato ‚ÄúüìÖ Dia da Semana, DD/MM/AAAA‚Äù no elemento `.current-day`.

---

## 11. Tarefas Peri√≥dicas

* **`ajustarRecurrentes(tarefas)`**

  * Para cada tarefa peri√≥dica expirada e n√£o-finalizada, calcula pr√≥ximo prazo (di√°rio, semanal, mensal ou customizado), cria nova entrada e marca a antiga como `finalizada`.
* **`processarTarefaPeriodicaAoMarcar(t)`**

  * Similar, mas disparado ao concluir manualmente (listener externo).

---

## 12. Intera√ß√µes Extras e Ordena√ß√£o

* **Clique em `.next-event`** abre modal com listas organizadas de:

  * Tarefas vencidas, futuras e conclu√≠das.
  * Concatena HTML via templates literais.
* **Ordenar por tipo/tempo**

  * Bot√µes `#ordenar-tipo` e `#ordenar-tempo` chamam `mostrarTarefasOrganizadas(criterio)`, que reagrupa ou reordena `tarefasFuturas` e atualiza o modal.

---

## 13. Fun√ß√£o Auxiliar de Tempo

```js
function calcularTempoRestante(dataLimite) { ‚Ä¶ }
```

* Retorna string ‚ÄúX dias, Y horas e Z minutos‚Äù ou ‚ÄúJ√° passou‚Äù.


---

